package ctrmap.util.tools;

import java.awt.event.FocusAdapter;
import java.awt.event.FocusEvent;
import javax.swing.JFormattedTextField;
import javax.swing.text.NumberFormatter;

public class CafeRvlBakeCoordConv extends javax.swing.JFrame {

	/**
	 * Creates new form CafeRvlBakeCoordConv
	 */
	public String cultureSeparator = ", ";

	public CafeRvlBakeCoordConv() {
		initComponents();
		setDoubleValueClass(new JFormattedTextField[]{cafeSX, cafeSY, cafeX, cafeY});
		FocusAdapter fa = new FocusAdapter() {
			@Override
			public void focusGained(FocusEvent e) {
				recalc();
			}

			@Override
			public void focusLost(FocusEvent e) {
				recalc();
			}
		};
		cafeSX.addFocusListener(fa);
		cafeSY.addFocusListener(fa);
		cafeX.addFocusListener(fa);
		cafeY.addFocusListener(fa);
		btnCalculate.addFocusListener(fa);
	}

	public void setDoubleValueClass(JFormattedTextField[] fields) {
		for (int i = 0; i < fields.length; i++) {
			((NumberFormatter) fields[i].getFormatter()).setValueClass(Double.class);
		}
	}

	/**
	 * This method is called from within the constructor to initialize the form.
	 * WARNING: Do NOT modify this code. The content of this method is always
	 * regenerated by the Form Editor.
	 */
	@SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jToggleButton1 = new javax.swing.JToggleButton();
        cafeY = new javax.swing.JFormattedTextField();
        cafeSXLabel = new javax.swing.JLabel();
        cafeSYLabel = new javax.swing.JLabel();
        cafeSY = new javax.swing.JFormattedTextField();
        cafeXLabel = new javax.swing.JLabel();
        cafeX = new javax.swing.JFormattedTextField();
        cafeSX = new javax.swing.JFormattedTextField();
        cafeYLabel = new javax.swing.JLabel();
        btnCalculate = new javax.swing.JButton();
        RVLLabel = new javax.swing.JLabel();
        CafeLabel = new javax.swing.JLabel();
        rvlXLabel = new javax.swing.JLabel();
        rvlX = new javax.swing.JFormattedTextField();
        rvlYLabel = new javax.swing.JLabel();
        rvlY = new javax.swing.JFormattedTextField();
        rvlSXLabel = new javax.swing.JLabel();
        rvlSX = new javax.swing.JFormattedTextField();
        rvlSYLabel = new javax.swing.JLabel();
        rvlSY = new javax.swing.JFormattedTextField();
        btnClear = new javax.swing.JButton();
        scaleVLabel = new javax.swing.JLabel();
        scaleV = new javax.swing.JTextField();
        transVLabel = new javax.swing.JLabel();
        transV = new javax.swing.JTextField();
        btnCultureSwitch = new javax.swing.JToggleButton();

        jToggleButton1.setText("jToggleButton1");

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        cafeY.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#0.000000"))));

        cafeSXLabel.setText("ScaleX");

        cafeSYLabel.setText("ScaleY");

        cafeSY.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#0.000000"))));

        cafeXLabel.setText("TranslX");

        cafeX.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#0.000000"))));

        cafeSX.setFormatterFactory(new javax.swing.text.DefaultFormatterFactory(new javax.swing.text.NumberFormatter(new java.text.DecimalFormat("#0.000000"))));

        cafeYLabel.setText("TranslY");

        btnCalculate.setText("Revolutionize");
        btnCalculate.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCalculateActionPerformed(evt);
            }
        });

        RVLLabel.setText("RVL (keep scale):");

        CafeLabel.setText("Cafe:");

        rvlXLabel.setText("TranslX");

        rvlYLabel.setText("TranslY");

        rvlSXLabel.setText("ScaleX");

        rvlSYLabel.setText("ScaleY");

        btnClear.setText("Clear");
        btnClear.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnClearActionPerformed(evt);
            }
        });

        scaleVLabel.setText("Scale vector:");

        transVLabel.setText("Translation vector:");

        btnCultureSwitch.setText("Invariant");
        btnCultureSwitch.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCultureSwitchActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(btnCalculate)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 225, Short.MAX_VALUE)
                        .addComponent(btnClear))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(cafeXLabel)
                            .addComponent(cafeSXLabel))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(cafeX)
                            .addComponent(cafeSX))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(cafeSYLabel)
                            .addComponent(cafeYLabel))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(cafeSY)
                            .addComponent(cafeY)))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(rvlSXLabel)
                            .addComponent(rvlXLabel))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(rvlX, javax.swing.GroupLayout.DEFAULT_SIZE, 139, Short.MAX_VALUE)
                            .addComponent(rvlSX))
                        .addGap(18, 18, 18)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(rvlSYLabel)
                            .addComponent(rvlYLabel))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(rvlSY)
                            .addComponent(rvlY)))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(transVLabel)
                            .addComponent(RVLLabel)
                            .addComponent(CafeLabel)
                            .addComponent(scaleVLabel))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(transV)
                            .addComponent(scaleV)))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(btnCultureSwitch)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(CafeLabel)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cafeSXLabel)
                    .addComponent(cafeSYLabel)
                    .addComponent(cafeSY, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cafeSX, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(cafeXLabel)
                    .addComponent(cafeX, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cafeY, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(cafeYLabel))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnCalculate)
                    .addComponent(btnClear))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(RVLLabel)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(rvlSXLabel)
                    .addComponent(rvlSYLabel)
                    .addComponent(rvlSY, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(rvlSX, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(rvlXLabel)
                    .addComponent(rvlX, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(rvlY, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(rvlYLabel))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(scaleVLabel)
                    .addComponent(scaleV, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(transVLabel)
                    .addComponent(transV, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(btnCultureSwitch)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnCalculateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCalculateActionPerformed
		recalc();
    }//GEN-LAST:event_btnCalculateActionPerformed

	private void recalc() {
		Double SX = (Double) cafeSX.getValue();
		Double SY = (Double) cafeSY.getValue();
		Double X = (Double) cafeX.getValue();
		Double Y = (Double) cafeY.getValue();
		if (SX != null && SY != null && X != null && Y != null) {
			if (!cultureSeparator.equals(", ")) {
				rvlSX.setValue(String.valueOf(SX).replace('.', ','));
				rvlSY.setValue(String.valueOf(SY).replace('.', ','));
			}
			else {
				rvlSX.setValue(String.valueOf(SX));
				rvlSY.setValue(String.valueOf(SY));
			}
			double intermediateX = Math.IEEEremainder(-(X / SX), 1 / SX);
			double intermediateY = Math.IEEEremainder((Y - 1) / SY + 1, 1 / SY);
			double absoluteScaleX = Math.abs(1 / SX);
			double absoluteScaleY = Math.abs(1 / SY);

			double outputX = (Math.abs(intermediateX) / absoluteScaleX > 0.5) ? Math.signum(intermediateX) * absoluteScaleX + intermediateX : intermediateX;
			double outputY = (Math.abs(intermediateY) / absoluteScaleY > 0.5) ? Math.signum(intermediateY) * absoluteScaleY + intermediateY : intermediateY;
			if (!cultureSeparator.equals(", ")) {
				rvlX.setValue(String.valueOf(outputX).replace('.', ','));
				rvlY.setValue(String.valueOf(outputY).replace('.', ','));
			} else {
				rvlX.setValue(String.valueOf(outputX));
				rvlY.setValue(String.valueOf(outputY));
			}
			scaleV.setText("(" + rvlSX.getValue() + cultureSeparator + rvlSY.getValue() + ")");
			transV.setText("(" + rvlX.getValue() + cultureSeparator + rvlY.getValue() + ")");
		}
	}

    private void btnClearActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnClearActionPerformed
		cafeSX.setValue(null);
		cafeSY.setValue(null);
		cafeX.setValue(null);
		cafeY.setValue(null);
		recalc();
    }//GEN-LAST:event_btnClearActionPerformed

    private void btnCultureSwitchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCultureSwitchActionPerformed
		if (cultureSeparator.equals(" ")) {
			cultureSeparator = ", ";
		} else {
			cultureSeparator = " ";
		}
		recalc();
    }//GEN-LAST:event_btnCultureSwitchActionPerformed

	/**
	 * @param args the command line arguments
	 */
	public static void main(String args[]) {
		/* Set the Nimbus look and feel */
		//<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
		/* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
		 */
		try {
			for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
				if ("Nimbus".equals(info.getName())) {
					javax.swing.UIManager.setLookAndFeel(info.getClassName());
					break;
				}
			}
		} catch (ClassNotFoundException ex) {
			java.util.logging.Logger.getLogger(CafeRvlBakeCoordConv.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (InstantiationException ex) {
			java.util.logging.Logger.getLogger(CafeRvlBakeCoordConv.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (IllegalAccessException ex) {
			java.util.logging.Logger.getLogger(CafeRvlBakeCoordConv.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		} catch (javax.swing.UnsupportedLookAndFeelException ex) {
			java.util.logging.Logger.getLogger(CafeRvlBakeCoordConv.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
		}
		//</editor-fold>

		/* Create and display the form */
		java.awt.EventQueue.invokeLater(new Runnable() {
			public void run() {
				new CafeRvlBakeCoordConv().setVisible(true);
			}
		});
	}

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel CafeLabel;
    private javax.swing.JLabel RVLLabel;
    private javax.swing.JButton btnCalculate;
    private javax.swing.JButton btnClear;
    private javax.swing.JToggleButton btnCultureSwitch;
    private javax.swing.JFormattedTextField cafeSX;
    private javax.swing.JLabel cafeSXLabel;
    private javax.swing.JFormattedTextField cafeSY;
    private javax.swing.JLabel cafeSYLabel;
    private javax.swing.JFormattedTextField cafeX;
    private javax.swing.JLabel cafeXLabel;
    private javax.swing.JFormattedTextField cafeY;
    private javax.swing.JLabel cafeYLabel;
    private javax.swing.JToggleButton jToggleButton1;
    private javax.swing.JFormattedTextField rvlSX;
    private javax.swing.JLabel rvlSXLabel;
    private javax.swing.JFormattedTextField rvlSY;
    private javax.swing.JLabel rvlSYLabel;
    private javax.swing.JFormattedTextField rvlX;
    private javax.swing.JLabel rvlXLabel;
    private javax.swing.JFormattedTextField rvlY;
    private javax.swing.JLabel rvlYLabel;
    private javax.swing.JTextField scaleV;
    private javax.swing.JLabel scaleVLabel;
    private javax.swing.JTextField transV;
    private javax.swing.JLabel transVLabel;
    // End of variables declaration//GEN-END:variables
}
